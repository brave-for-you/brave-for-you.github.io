<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Raspberry pi</title>
      <link href="/2024/04/16/centos-7.9/"/>
      <url>/2024/04/16/centos-7.9/</url>
      
        <content type="html"><![CDATA[<p>关于<a href="mailto:&#x43;&#x65;&#110;&#116;&#79;&#115;&#64;&#55;&#46;&#57;">&#x43;&#x65;&#110;&#116;&#79;&#115;&#64;&#55;&#46;&#57;</a> 初次使用注意以及基本内容，持续完善中…</p><h2 id="首次启动"><a href="#首次启动" class="headerlink" title="首次启动"></a>首次启动</h2><h3 id="新增用户"><a href="#新增用户" class="headerlink" title="新增用户"></a>新增用户</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adduser username</span><br><span class="line">passwd username</span><br></pre></td></tr></table></figure><h3 id="关于yum、rpm基本命令"><a href="#关于yum、rpm基本命令" class="headerlink" title="关于yum、rpm基本命令"></a>关于yum、rpm基本命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install -y name</span><br><span class="line">yum remove name</span><br><span class="line">yum clean</span><br><span class="line">yum localinstall rpm包地址</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询所有rpm包，grep筛选出包含mysql的内容</span></span><br><span class="line">rpm -qa | grep mysql</span><br></pre></td></tr></table></figure><h3 id="python3-11-1安装"><a href="#python3-11-1安装" class="headerlink" title="python3.11.1安装"></a>python3.11.1安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载文件到临时目录</span></span><br><span class="line">cd /temp</span><br><span class="line">wget https://www.python.org/ftp/python/3.11.1/Python-3.11.1.tgz</span><br><span class="line">tar -xzf Python-3.11.1.tgz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装依赖环境</span></span><br><span class="line">yum -y install gcc zlib zlib-devel libffi libffi-devel</span><br><span class="line">yum install readline-devel</span><br><span class="line">yum install openssl-devel openssl11 openssl11-devel</span><br><span class="line">export CFLAGS=$(pkg-config --cflags openssl11)</span><br><span class="line">export LDFLAGS=$(pkg-config --libs openssl11)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入下载文件解压地址</span></span><br><span class="line">cd Python-3.11.1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定安装路径</span></span><br><span class="line">./configure --prefix=/usr/bin/python3.11 --with-ssl</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">软链指向</span></span><br><span class="line">ln -s /usr/bin/python3.11/bin/python3 /usr/bin/python3</span><br><span class="line">ln -s /usr/bin/python3.11/bin/pip3 /usr/bin/pip3</span><br></pre></td></tr></table></figure><h3 id="修改python默认版本软链指向"><a href="#修改python默认版本软链指向" class="headerlink" title="修改python默认版本软链指向"></a>修改python默认版本软链指向</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">慎重修改， 部分系统安装是默认依赖版本是python2</span></span><br><span class="line">sudo rm -rf /usr/bin/python</span><br><span class="line">sudo ln -s /usr/bin/python3 /usr/bin/python</span><br></pre></td></tr></table></figure><h3 id="x43-101-110-116-x4f-x73-64-55-46-x39-安装mysql"><a href="#x43-101-110-116-x4f-x73-64-55-46-x39-安装mysql" class="headerlink" title="&#x43;&#101;&#110;&#116;&#x4f;&#x73;&#64;&#55;&#46;&#x39; 安装mysql"></a><a href="mailto:&#x43;&#101;&#110;&#116;&#x4f;&#x73;&#64;&#55;&#46;&#x39;">&#x43;&#101;&#110;&#116;&#x4f;&#x73;&#64;&#55;&#46;&#x39;</a> 安装mysql</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查历史版本</span></span><br><span class="line">rpm -qa | grep -i mysql</span><br><span class="line">rpm -qa | grep -i mariadb</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载历史版本（如已安装过）</span></span><br><span class="line">yum remove -y mysql安装包名称</span><br><span class="line">yum remove -y mariadb安装包名称</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清理残留数据目录及文件-示例</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除安装目录</span></span><br><span class="line">whereis mysql</span><br><span class="line">rm -rf /usr/lib64/mysql /usr/share/mysql</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除数据目录</span></span><br><span class="line">rm -rf /var/lib/mysql</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除配置文件</span></span><br><span class="line">rm -rf /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除日志文件</span></span><br><span class="line">rm -rf /var/log/mysql</span><br><span class="line">rm -rf /var/log/mysqld.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除临时文件</span></span><br><span class="line">rm -rf /tmp/mysql*</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除服务和启动脚本</span></span><br><span class="line">rm -rf /etc/init.d/mysql</span><br><span class="line">rm -rf /usr/lib/systemd/system/mysql.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载mysql官方yum源</span></span><br><span class="line">wget  https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装官方yum源</span></span><br><span class="line">rpm -ivh mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清理yum缓存目录</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新上传yum缓存</span></span><br><span class="line">yum makecache</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">导入GPG密钥（查看官方最新源https://repo.mysql.com/）</span></span><br><span class="line">rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2023</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装mysql</span></span><br><span class="line">yum install -y mysql-community-server mysql-community</span><br><span class="line">mysql -V</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看临时初始密码</span></span><br><span class="line">grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Dev-Memos</title>
      <link href="/2024/03/26/dev-memos/"/>
      <url>/2024/03/26/dev-memos/</url>
      
        <content type="html"><![CDATA[<p>一些感觉有意思的代码片段记录，持续更新记录…</p><h2 id="加解密"><a href="#加解密" class="headerlink" title="加解密"></a>加解密</h2><h3 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">compileStr</span>(<span class="params">code</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> c = <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(code.<span class="title function_">charCodeAt</span>(<span class="number">0</span>) + code.<span class="property">length</span>)</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; code.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    c += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(code.<span class="title function_">charCodeAt</span>(i) + code.<span class="title function_">charCodeAt</span>(i - <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">escape</span>(c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">unCompileStr</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> code = <span class="built_in">unescape</span>(str)</span><br><span class="line">  <span class="keyword">let</span> c = <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(code.<span class="title function_">charCodeAt</span>(<span class="number">0</span>) - code.<span class="property">length</span>)</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; code.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    c += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(code.<span class="title function_">charCodeAt</span>(i) - c.<span class="title function_">charCodeAt</span>(i - <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="时间内容"><a href="#时间内容" class="headerlink" title="时间内容"></a>时间内容</h2><h3 id="时分秒倒计时（09-59-20）"><a href="#时分秒倒计时（09-59-20）" class="headerlink" title="时分秒倒计时（09:59:20）"></a>时分秒倒计时（09:59:20）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// timeStamp为毫秒</span></span><br><span class="line"><span class="title function_">handleToSetTimerFn</span>(<span class="params">timeStamp</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> t = timeStamp</span><br><span class="line"><span class="keyword">let</span> h = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> m = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="number">0</span></span><br><span class="line">h = <span class="title class_">Math</span>.<span class="title function_">floor</span>(t / (<span class="number">60</span> * <span class="number">60</span>))</span><br><span class="line">h &lt; <span class="number">10</span> &amp;&amp; (h = <span class="string">&quot;0&quot;</span> + h)</span><br><span class="line">m = <span class="title class_">Math</span>.<span class="title function_">floor</span>(t / <span class="number">60</span> % <span class="number">60</span>)</span><br><span class="line">m &lt; <span class="number">10</span> &amp;&amp; (m = <span class="string">&quot;0&quot;</span> + m)</span><br><span class="line">s = <span class="title class_">Math</span>.<span class="title function_">floor</span>(t % <span class="number">60</span>)</span><br><span class="line"><span class="keyword">let</span> _thisTemp = <span class="variable language_">this</span></span><br><span class="line">timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">s--</span><br><span class="line">s &lt; <span class="number">10</span> &amp;&amp; (s = <span class="string">&quot;0&quot;</span> + s)</span><br><span class="line"><span class="keyword">if</span> (s.<span class="property">length</span> &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">s = <span class="number">59</span></span><br><span class="line">m = (<span class="title class_">Number</span>(m) - <span class="number">1</span>)</span><br><span class="line">m &lt; <span class="number">10</span> &amp;&amp; (m = <span class="string">&quot;0&quot;</span> + m)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (m.<span class="property">length</span> &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">m = <span class="number">59</span></span><br><span class="line">h = (<span class="title class_">Number</span>(h) - <span class="number">1</span>)</span><br><span class="line">h &lt; <span class="number">10</span> &amp;&amp; (h = <span class="string">&quot;0&quot;</span> + h)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (h.<span class="property">length</span> &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">h = <span class="string">&quot;00&quot;</span></span><br><span class="line">m = <span class="string">&quot;00&quot;</span></span><br><span class="line">s = <span class="string">&quot;00&quot;</span></span><br><span class="line"><span class="built_in">clearInterval</span>(timer)</span><br><span class="line">&#125;</span><br><span class="line">_thisTemp.<span class="property">timerStr</span> = (h + <span class="string">&quot;:&quot;</span> + m + <span class="string">&quot;:&quot;</span> + s)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="秒转换时分秒（10-00-00）"><a href="#秒转换时分秒（10-00-00）" class="headerlink" title="秒转换时分秒（10:00:00）"></a>秒转换时分秒（10:00:00）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleformatSeconds</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(!value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> second = <span class="built_in">parseInt</span>(value)</span><br><span class="line">  <span class="keyword">let</span> minute = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> hour = <span class="number">0</span></span><br><span class="line">  <span class="keyword">if</span> (second &gt; <span class="number">60</span>) &#123;</span><br><span class="line">    minute = <span class="built_in">parseInt</span>(second / <span class="number">60</span>)</span><br><span class="line">    second = <span class="built_in">parseInt</span>(second % <span class="number">60</span>)</span><br><span class="line">    <span class="keyword">if</span> (minute &gt; <span class="number">60</span>) &#123;</span><br><span class="line">      hour = <span class="built_in">parseInt</span>(minute / <span class="number">60</span>)</span><br><span class="line">      minute = <span class="built_in">parseInt</span>(minute % <span class="number">60</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> result = (<span class="built_in">parseInt</span>(hour) &gt;= <span class="number">10</span> ? <span class="built_in">parseInt</span>(hour) : <span class="string">&#x27;0&#x27;</span> + <span class="built_in">parseInt</span>(hour)) + <span class="string">&#x27;:&#x27;</span> + (<span class="built_in">parseInt</span>(minute) &gt;= <span class="number">10</span> ? <span class="built_in">parseInt</span>(minute) : <span class="string">&#x27;0&#x27;</span> + <span class="built_in">parseInt</span>(minute)) +<span class="string">&#x27;:&#x27;</span>+ (<span class="built_in">parseInt</span>(second) &gt;= <span class="number">10</span> ? <span class="built_in">parseInt</span>(second) : <span class="string">&#x27;0&#x27;</span> + <span class="built_in">parseInt</span>(second))</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="时间范围与当前时间前后对比"><a href="#时间范围与当前时间前后对比" class="headerlink" title="时间范围与当前时间前后对比"></a>时间范围与当前时间前后对比</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_handleToCompareTime</span>(<span class="params">tempStartTimeStr, tempEndTimeStr</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> tempStartTime = <span class="keyword">new</span> <span class="title class_">Date</span>(tempStartTimeStr).<span class="title function_">getTime</span>()</span><br><span class="line"><span class="keyword">const</span> tempEndTime = <span class="keyword">new</span> <span class="title class_">Date</span>(tempEndTimeStr).<span class="title function_">getTime</span>()</span><br><span class="line"><span class="keyword">const</span> thisTempTime = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line"><span class="keyword">if</span> (thisTempTime &lt; tempStartTime) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">round</span>((tempStartTime - thisTempTime) / <span class="number">1000</span> / <span class="number">60</span>)) <span class="comment">// 距离开始剩余时间（minute）</span></span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span> <span class="comment">// 范围前</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (thisTempTime &gt; tempStartTime &amp;&amp; thisTempTime &lt; tempEndTime) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">round</span>((tempEndTime - thisTempTime) / <span class="number">1000</span> / <span class="number">60</span>)) <span class="comment">// 距离结束剩余时间（minute）</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span> <span class="comment">// 范围中</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span> <span class="comment">// 范围后</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="判断对比输入日期与当前日期"><a href="#判断对比输入日期与当前日期" class="headerlink" title="判断对比输入日期与当前日期"></a>判断对比输入日期与当前日期</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">_handleToCompareTime</span>(<span class="params">dateString</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!dateString) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> currentDate = <span class="keyword">new</span> <span class="title class_">Date</span>() <span class="comment">// 获取当前日期</span></span><br><span class="line">  <span class="keyword">const</span> inputDate = <span class="keyword">new</span> <span class="title class_">Date</span>(dateString) <span class="comment">// 将输入的日期字符串转换为Date对象</span></span><br><span class="line">  <span class="keyword">if</span> (inputDate &gt; currentDate) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// 如果输入的日期大于当前日期</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// 输入日期小于或等于当前日期</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">_handleToCompareTime</span>(<span class="string">&#x27;2024-05-01&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="时间格式化"><a href="#时间格式化" class="headerlink" title="时间格式化"></a>时间格式化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">dateFormat</span>(<span class="params">date, format</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">zeroPadding</span> = (<span class="params">i</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> (i &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> : <span class="string">&#x27;&#x27;</span>) + i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> format.<span class="title function_">replace</span>(<span class="regexp">/yyyy|MM|dd|HH|mm|ss/g</span>, <span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (item) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;yyyy&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getFullYear</span>())</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;MM&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getMonth</span>() + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;dd&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getDate</span>())</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;HH&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getHours</span>())</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;mm&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getMinutes</span>())</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;ss&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getSeconds</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">dateFormat</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="时间格式化-一年前的时间"><a href="#时间格式化-一年前的时间" class="headerlink" title="时间格式化 一年前的时间"></a>时间格式化 一年前的时间</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">oldDateFormat</span>(<span class="params">date, format</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">zeroPadding</span> = (<span class="params">i</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> (i &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> : <span class="string">&#x27;&#x27;</span>) + i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> format.<span class="title function_">replace</span>(<span class="regexp">/yyyy|MM|dd|HH|mm|ss/g</span>, <span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (item) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;yyyy&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getFullYear</span>() - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;MM&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getMonth</span>() + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;dd&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getDate</span>())</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;HH&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getHours</span>())</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;mm&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getMinutes</span>())</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;ss&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">zeroPadding</span>(date.<span class="title function_">getSeconds</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">dateFormat</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="ElementUi日期组件"><a href="#ElementUi日期组件" class="headerlink" title="ElementUi日期组件"></a>ElementUi日期组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ElementUi组件禁用当前时间前2天后5天以外的内容</span></span><br><span class="line"><span class="attr">disabledDate</span>: <span class="function">(<span class="params">date</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> date.<span class="title function_">getTime</span>() &lt; <span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="number">2</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span> || date.<span class="title function_">getTime</span>() &gt; <span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="number">5</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="文件内容"><a href="#文件内容" class="headerlink" title="文件内容"></a>文件内容</h2><h3 id="文件流下载"><a href="#文件流下载" class="headerlink" title="文件流下载"></a>文件流下载</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleReturnDownloadFile</span>(<span class="params">content,filename</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> eleLink = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">  eleLink.<span class="property">download</span> = filename</span><br><span class="line">  eleLink.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">  <span class="comment">// 字符内容转变成blob地址 </span></span><br><span class="line">  <span class="keyword">let</span> url= <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(<span class="keyword">new</span> <span class="title class_">Blob</span>([data], &#123; <span class="attr">type</span>: <span class="string">&#x27;application/octet-stream&#x27;</span> &#125;))</span><br><span class="line">  eleLink.<span class="property">href</span> = url </span><br><span class="line">  <span class="comment">// 自动触发点击 </span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(eleLink)</span><br><span class="line">  eleLink.<span class="title function_">click</span>()</span><br><span class="line">  <span class="comment">// 然后移除 </span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(eleLink)</span><br><span class="line"><span class="comment">//释放</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">revokeObjectURL</span>(url)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Base64转img"><a href="#Base64转img" class="headerlink" title="Base64转img"></a>Base64转img</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">convertBase64UrlToBlob</span>(<span class="params">urlData</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> bytes = <span class="variable language_">window</span>.<span class="title function_">atob</span>(urlData)</span><br><span class="line">  <span class="comment">// 处理异常,将ascii码小于0的转换为大于0</span></span><br><span class="line">  <span class="keyword">let</span> ab = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(bytes.<span class="property">length</span>)</span><br><span class="line">  <span class="keyword">let</span> ia = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(ab)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; bytes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    ia[i] = bytes.<span class="title function_">charCodeAt</span>(i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Blob</span>([ab], &#123;<span class="attr">type</span>: <span class="string">&#x27;image/jpg&#x27;</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="img转Base64"><a href="#img转Base64" class="headerlink" title="img转Base64"></a>img转Base64</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">convertBlobToBase64Url</span>(<span class="params">file</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> image = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">        image.<span class="property">src</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(file)</span><br><span class="line">        image.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>)</span><br><span class="line">            <span class="keyword">let</span> content = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span><br><span class="line">            canvas.<span class="property">width</span> = image.<span class="property">width</span></span><br><span class="line">            canvas.<span class="property">height</span> = image.<span class="property">height</span></span><br><span class="line">            content.<span class="title function_">drawImage</span>(image, <span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>)</span><br><span class="line">            <span class="title function_">resolve</span>(canvas.<span class="title function_">toDataURL</span>(file.<span class="property">type</span>))</span><br><span class="line">            canvas.<span class="property">width</span> = canvas.<span class="property">height</span> = <span class="number">0</span></span><br><span class="line">            content.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">            canvas = <span class="literal">null</span></span><br><span class="line">            content = <span class="literal">null</span></span><br><span class="line">            image = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        image.<span class="property">onerror</span> = <span class="function">(<span class="params">event, source, lineno, colno, error</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(event, source, lineno, colno, error)</span><br><span class="line">                <span class="title function_">reject</span>(error)</span><br><span class="line">                image = <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获取图片"><a href="#获取图片" class="headerlink" title="获取图片"></a>获取图片</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">chooseImage</span>(<span class="params">option</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> imageInput = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;input&#x27;</span>)</span><br><span class="line">        imageInput.<span class="property">type</span> = <span class="string">&#x27;file&#x27;</span></span><br><span class="line">        imageInput.<span class="property">accept</span> = <span class="string">&#x27;image/*&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> (option.<span class="property">sourceType</span> === <span class="string">&#x27;camera&#x27;</span>) &#123;</span><br><span class="line">            imageInput.<span class="property">capture</span> = <span class="string">&#x27;environment&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        imageInput.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">        imageInput.<span class="property">style</span>.<span class="property">width</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">        imageInput.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;fixed&#x27;</span></span><br><span class="line">        imageInput.<span class="property">style</span>.<span class="property">left</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">        imageInput.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">        imageInput.<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">&#x27;hidden&#x27;</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(imageInput)</span><br><span class="line">        imageInput.<span class="property">onchange</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">files</span>.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> image = e.<span class="property">target</span>.<span class="property">files</span>[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">let</span> gifFlag = image.<span class="property">type</span>.<span class="title function_">includes</span>(<span class="string">&#x27;gif&#x27;</span>)</span><br><span class="line">                <span class="comment">// 设置了压缩但是图片为gif图片打印错误提示</span></span><br><span class="line">                <span class="keyword">if</span> (option.<span class="property">compress</span> &amp;&amp; gifFlag) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&#x27;前端不具备压缩gif动图的能力，请服务端处理&#x27;</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 不是gif图片 设置了压缩 并且 大于1.8M才会触发压缩</span></span><br><span class="line">                <span class="keyword">const</span> compress = !gifFlag &amp;&amp; option.<span class="property">compress</span> &amp;&amp; image.<span class="property">size</span> &gt; <span class="number">1572864</span></span><br><span class="line">                <span class="comment">// 达到压缩条件开始压缩</span></span><br><span class="line">                <span class="keyword">if</span> (compress) &#123;</span><br><span class="line">                    <span class="comment">// 大于1.8M才会触发压缩</span></span><br><span class="line">                    image = <span class="keyword">await</span> <span class="title function_">compressImageHandler</span>(image)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">const</span> result = &#123;</span><br><span class="line">                    <span class="attr">file</span>: image,</span><br><span class="line">                    <span class="attr">name</span>: image.<span class="property">name</span>,</span><br><span class="line">                    <span class="attr">size</span>: image.<span class="property">size</span>,</span><br><span class="line">                    <span class="attr">path</span>: !compress || gifFlag ? <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(image) : <span class="keyword">await</span> <span class="title function_">imageToBase64Handler</span>(image),</span><br><span class="line">                    <span class="attr">type</span>: image.<span class="property">type</span>,</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">typeof</span> option.<span class="property">success</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; option.<span class="title function_">success</span>(result)</span><br><span class="line">                <span class="keyword">typeof</span> option.<span class="property">complete</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; option.<span class="title function_">complete</span>(result)</span><br><span class="line">                imageInput.<span class="title function_">remove</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        imageInput.<span class="title function_">click</span>()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">typeof</span> option.<span class="property">fail</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; option.<span class="title function_">fail</span>(e)</span><br><span class="line">        <span class="keyword">typeof</span> option.<span class="property">complete</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; option.<span class="title function_">complete</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">chooseImage</span>(&#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="选取视频"><a href="#选取视频" class="headerlink" title="选取视频"></a>选取视频</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">chooseVideo</span>(<span class="params">option = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> fileInput = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;input&#x27;</span>)</span><br><span class="line">        fileInput.<span class="property">type</span> = <span class="string">&#x27;file&#x27;</span></span><br><span class="line">        fileInput.<span class="property">accept</span> = <span class="string">&#x27;video/*&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> (option.<span class="property">sourceType</span> === <span class="string">&#x27;camera&#x27;</span>) &#123;</span><br><span class="line">            fileInput.<span class="property">capture</span> = option.<span class="property">camera</span> ? (option.<span class="property">camera</span> === <span class="string">&#x27;front&#x27;</span> ? <span class="string">&#x27;user&#x27;</span> : <span class="string">&#x27;environment&#x27;</span>) : <span class="string">&#x27;user&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        fileInput.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">        fileInput.<span class="property">style</span>.<span class="property">width</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">        fileInput.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;fixed&#x27;</span></span><br><span class="line">        fileInput.<span class="property">style</span>.<span class="property">left</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">        fileInput.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&#x27;0px&#x27;</span></span><br><span class="line">        fileInput.<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">&#x27;hidden&#x27;</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;body&#x27;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(fileInput)</span><br><span class="line">        fileInput.<span class="property">onchange</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">files</span>.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> file = e.<span class="property">target</span>.<span class="property">files</span>[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">const</span> result = &#123;</span><br><span class="line">                    file,</span><br><span class="line">                    <span class="attr">name</span>: file.<span class="property">name</span>,</span><br><span class="line">                    <span class="attr">size</span>: file.<span class="property">size</span>,</span><br><span class="line">                    <span class="attr">path</span>: <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(file),</span><br><span class="line">                    <span class="attr">type</span>: file.<span class="property">type</span>,</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">typeof</span> option.<span class="property">success</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; option.<span class="title function_">success</span>(result)</span><br><span class="line">                <span class="keyword">typeof</span> option.<span class="property">complete</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; option.<span class="title function_">complete</span>(result)</span><br><span class="line">                fileInput.<span class="title function_">remove</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        fileInput.<span class="title function_">click</span>()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">typeof</span> option.<span class="property">fail</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; option.<span class="title function_">fail</span>(e)</span><br><span class="line">        <span class="keyword">typeof</span> option.<span class="property">complete</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp; option.<span class="title function_">complete</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">chooseVideo</span>(&#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="字符串内容"><a href="#字符串内容" class="headerlink" title="字符串内容"></a>字符串内容</h2><h3 id="数字校验"><a href="#数字校验" class="headerlink" title="数字校验"></a>数字校验</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="regexp">/[0-9]/</span>.<span class="title function_">exec</span>(<span class="title class_">Str</span>) != <span class="literal">null</span> ? <span class="number">1</span> : <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="字母校验"><a href="#字母校验" class="headerlink" title="字母校验"></a>字母校验</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="regexp">/[a-zA-Z]/</span>.<span class="title function_">exec</span>(<span class="title class_">Str</span>) != <span class="literal">null</span> ? <span class="number">1</span> : <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="营业执照统一信用编码校验"><a href="#营业执照统一信用编码校验" class="headerlink" title="营业执照统一信用编码校验"></a>营业执照统一信用编码校验</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/[0-9A-HJ-NPQRTUWXY]&#123;2&#125;\d&#123;6&#125;[0-9A-HJ-NPQRTUWXY]&#123;10&#125;/</span>.<span class="title function_">exec</span>(<span class="title class_">Str</span>)</span><br></pre></td></tr></table></figure><h3 id="字节统计"><a href="#字节统计" class="headerlink" title="字节统计"></a>字节统计</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleToCountStrLength</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> len = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; str.<span class="property">length</span>; i++) &#123; </span><br><span class="line">    <span class="keyword">let</span> c = str.<span class="title function_">charAt</span>(i)</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/^[\u0000-\u00ffA-Za-z1-9]+$/</span>.<span class="title function_">test</span>(c)) &#123; </span><br><span class="line">      len += <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">      len += <span class="number">2</span></span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> len</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字符串转大写"><a href="#字符串转大写" class="headerlink" title="字符串转大写"></a>字符串转大写</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line">str.<span class="title function_">toUpperCase</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str) <span class="comment">// ABC</span></span><br></pre></td></tr></table></figure><h3 id="键盘输入限制只有大写字母"><a href="#键盘输入限制只有大写字母" class="headerlink" title="键盘输入限制只有大写字母"></a>键盘输入限制只有大写字母</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  @input=&quot;scope.row.accountNo = handleToCheckValFn(scope.row.accountNo)&quot;</span></span><br><span class="line"><span class="title function_">_handleToCheckValFn</span>(<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> regex = <span class="regexp">/^[A-Z]+$/</span> <span class="comment">// 只填大写字母</span></span><br><span class="line">  <span class="comment">// const regex = /^[0-9]+$/ // 只填数字</span></span><br><span class="line">  <span class="keyword">let</span> tempStr = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> val) &#123;</span><br><span class="line">    <span class="keyword">if</span>(regex.<span class="title function_">test</span>(val[i])) &#123;</span><br><span class="line">      tempStr += val[i]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> tempStr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="普通校验（手机号、邮箱、身份证号）"><a href="#普通校验（手机号、邮箱、身份证号）" class="headerlink" title="普通校验（手机号、邮箱、身份证号）"></a>普通校验（手机号、邮箱、身份证号）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">validatePhone</span> = (<span class="params">rule, value, callback = () =&gt; &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(!value) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;手机号码不能为空！&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="regexp">/^1[3456789]\d&#123;9&#125;$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;手机号码不正确！&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">callback</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">validateEmial</span> = (<span class="params">rule, value, callback = () =&gt; &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(!value) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;邮箱不能为空！&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="regexp">/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;邮箱格式不正确！&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">callback</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">validateIdCard</span> = (<span class="params">rule, value, callback = () =&gt; &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(!value) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;身份证号不能为空！&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="regexp">/^[1-9]\d&#123;5&#125;(?:18|19|20|21|22)\d&#123;2&#125;(?:0[1-9]|10|11|12)(?:0[1-9]|[1-2]\d|30|31)\d&#123;3&#125;[$/.test(value)) &#123;</span></span><br><span class="line"><span class="regexp">        return callback(new Error(&#x27;身份证号不正确！&#x27;))</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    return callback()</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="首字母大写"><a href="#首字母大写" class="headerlink" title="首字母大写"></a>首字母大写</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">firstChartToUpperCase</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> str === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> str.<span class="title function_">charAt</span>(<span class="number">0</span>).<span class="title function_">toUpperCase</span>() + str.<span class="title function_">substr</span>(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字符串转驼峰"><a href="#字符串转驼峰" class="headerlink" title="字符串转驼峰"></a>字符串转驼峰</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">stringTurnHump</span>(<span class="params">str, symbol = <span class="string">&#x27;-&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> str === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> str.<span class="title function_">split</span>(symbol).<span class="title function_">map</span>(<span class="function">(<span class="params">value, index</span>) =&gt;</span> (index &gt; <span class="number">0</span> ? <span class="title function_">firstChartToUpperCase</span>(value) : value)).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="css字符串转JS对象"><a href="#css字符串转JS对象" class="headerlink" title="css字符串转JS对象"></a>css字符串转JS对象</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">stringTurnObjectForCSS</span>(<span class="params">cssString</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (cssString) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(cssString.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> value.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">val, index</span>) =&gt;</span> (index === <span class="number">0</span> ? <span class="title function_">stringTurnHump</span>(val) : val))))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cssString</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="手机号脱敏"><a href="#手机号脱敏" class="headerlink" title="手机号脱敏"></a>手机号脱敏</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">formatPhone</span>(<span class="params">phoneNumber</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="title function_">checkPhoneNumber</span>(phoneNumber)</span><br><span class="line">    <span class="keyword">if</span> (result.<span class="property">success</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> phoneNumber.<span class="title function_">toString</span>().<span class="title function_">replace</span>(<span class="regexp">/(.&#123;4&#125;)(.&#123;4&#125;)(.&#123;3&#125;)/</span>, <span class="string">&#x27;$1****$3&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result.<span class="property">message</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="脱敏银行卡号"><a href="#脱敏银行卡号" class="headerlink" title="脱敏银行卡号"></a>脱敏银行卡号</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">desensitizeBankCardNumber</span>(<span class="params">cardNumber</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> str = <span class="title class_">String</span>(cardNumber)</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">substring</span>(str.<span class="property">length</span> - <span class="number">4</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="金额转换千分位格式"><a href="#金额转换千分位格式" class="headerlink" title="金额转换千分位格式"></a>金额转换千分位格式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 金额转换千分位格式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> money 需转换的金额</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fixedLength &#123;number|null&#125; 保留几位小数 false 不处理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">string|*</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">convertThousandth</span>(<span class="params">money, fixedLength = <span class="literal">null</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(<span class="title class_">Number</span>(money))) &#123;</span><br><span class="line">        <span class="keyword">return</span> money</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> _money = <span class="title class_">Number</span>(money).<span class="title function_">toString</span>()</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fixedLength === <span class="string">&#x27;number&#x27;</span> &amp;&amp; !<span class="built_in">isNaN</span>(fixedLength)) &#123;</span><br><span class="line">        _money = <span class="title function_">toFixed</span>(money, fixedLength)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_money.<span class="title function_">indexOf</span>(<span class="string">&#x27;.&#x27;</span>) === -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> _money.<span class="title function_">replace</span>(<span class="regexp">/\B(?=(?:\d&#123;3&#125;)+\b)/g</span>, <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _money.<span class="title function_">replace</span>(<span class="regexp">/(\d)(?=(\d&#123;3&#125;)+\.)/g</span>, <span class="string">&#x27;$1,&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="身份证号校验（号码-区号）"><a href="#身份证号校验（号码-区号）" class="headerlink" title="身份证号校验（号码+区号）"></a>身份证号校验（号码+区号）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> areaCode = <span class="string">&#x27;1100,1101,1102,1200,1201,1202,1300,1301,1302,1303,1304,1305,1306,1307,1308,1309,1310,1311,1400,1401,1402,1403,1404,1405,1406,1407,1408,1409,1410,1411,1500,1501,1502,1503,1504,1505,1506,1507,1508,1509,1522,1525,1526,1529,2100,2101,2102,2103,2104,2105,2106,2107,2108,2109,2110,2111,2112,2113,2114,2200,2201,2202,2203,2204,2205,2206,2207,2208,2224,2300,2301,2302,2303,2304,2305,2306,2307,2308,2309,2310,2311,2312,2327,3100,3101,3102,3200,3201,3202,3203,3204,3205,3206,3207,3208,3209,3210,3211,3212,3213,3300,3301,3302,3303,3304,3305,3306,3307,3308,3309,3310,3311,3400,3401,3402,3403,3404,3405,3406,3407,3408,3410,3411,3412,3413,3414,3415,3416,3417,3418,3500,3501,3502,3503,3504,3505,3506,3507,3508,3509,3600,3601,3602,3603,3604,3605,3606,3607,3608,3609,3610,3611,3700,3701,3702,3703,3704,3705,3706,3707,3708,3709,3710,3711,3712,3713,3714,3715,3716,3717,4100,4101,4102,4103,4104,4105,4106,4107,4108,4109,4110,4111,4112,4113,4114,4115,4116,4117,4200,4201,4202,4203,4205,4206,4207,4208,4209,4210,4211,4212,4213,4228,4290,4300,4301,4302,4303,4304,4305,4306,4307,4308,4309,4310,4311,4312,4313,4331,4400,4401,4402,4403,4404,4405,4406,4407,4408,4409,4412,4413,4414,4415,4416,4417,4418,4419,4420,4451,4452,4453,4500,4501,4502,4503,4504,4505,4506,4507,4508,4509,4510,4511,4512,4513,4514,4600,4601,4602,4690,5000,5001,5002,5003,5100,5101,5103,5104,5105,5106,5107,5108,5109,5110,5111,5113,5114,5115,5116,5117,5118,5119,5120,5132,5133,5134,5200,5201,5202,5203,5204,5222,5223,5224,5226,5227,5300,5301,5303,5304,5305,5306,5307,5308,5309,5323,5325,5326,5328,5329,5331,5333,5334,5400,5401,5421,5422,5423,5424,5425,5426,6100,6101,6102,6103,6104,6105,6106,6107,6108,6109,6110,6200,6201,6202,6203,6204,6205,6206,6207,6208,6209,6210,6211,6226,6229,6230,6300,6301,6321,6322,6323,6325,6326,6327,6328,6400,6401,6402,6403,6404,6405,6500,6501,6502,6521,6522,6523,6527,6528,6529,6530,6531,6532,6540,6542,6543,6590,7100,8100,8200&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">validateIdCard</span> = (<span class="params">rule, value, callback = () =&gt; &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span>(!value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;身份证号不能为空！&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="regexp">/^[1-9]\d&#123;5&#125;(?:18|19|20|21|22)\d&#123;2&#125;(?:0[1-9]|10|11|12)(?:0[1-9]|[1-2]\d|30|31)\d&#123;3&#125;[\dX]$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;身份证号不正确！&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 前4位区号有效验证</span></span><br><span class="line">  <span class="keyword">if</span>(!areaCode.<span class="title function_">includes</span>(value.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">3</span>))) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;身份证号不正确！&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">callback</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="根据身份证号计算内容"><a href="#根据身份证号计算内容" class="headerlink" title="根据身份证号计算内容"></a>根据身份证号计算内容</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">computeIdCardFn</span>(<span class="params">IdCard, type</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title class_">IdCard</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">//获取出生日期</span></span><br><span class="line">    <span class="keyword">let</span> birthday = <span class="title class_">IdCard</span>.<span class="title function_">substring</span>(<span class="number">6</span>, <span class="number">10</span>) + <span class="string">&#x27;-&#x27;</span> + <span class="title class_">IdCard</span>.<span class="title function_">substring</span>(<span class="number">10</span>, <span class="number">12</span>) + <span class="string">&#x27;-&#x27;</span> + <span class="title class_">IdCard</span>.<span class="title function_">substring</span>(<span class="number">12</span>, <span class="number">14</span>)</span><br><span class="line">    <span class="keyword">return</span> birthday</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sex = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">//获取性别</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">parseInt</span>(<span class="title class_">IdCard</span>.<span class="title function_">substr</span>(<span class="number">16</span>, <span class="number">1</span>)) % <span class="number">2</span> === <span class="number">1</span>) &#123;</span><br><span class="line">      sex = <span class="string">&#x27;男&#x27;</span></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      sex = <span class="string">&#x27;女&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sex</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="comment">//获取年龄</span></span><br><span class="line">    <span class="keyword">let</span> ageDate = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">    <span class="keyword">let</span> month = ageDate.<span class="title function_">getMonth</span>() + <span class="number">1</span></span><br><span class="line">    <span class="keyword">let</span> day = ageDate.<span class="title function_">getDate</span>()</span><br><span class="line">    <span class="keyword">let</span> age = ageDate.<span class="title function_">getFullYear</span>() - <span class="title class_">IdCard</span>.<span class="title function_">substring</span>(<span class="number">6</span>, <span class="number">10</span>) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">IdCard</span>.<span class="title function_">substring</span>(<span class="number">10</span>, <span class="number">12</span>) &lt; month || <span class="title class_">IdCard</span>.<span class="title function_">substring</span>(<span class="number">10</span>, <span class="number">12</span>) === month &amp;&amp; <span class="title class_">IdCard</span>.<span class="title function_">substring</span>(<span class="number">12</span>, <span class="number">14</span>) &lt;= day) &#123;</span><br><span class="line">      age++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (age &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      age = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="VUE加载自动触发元素点击事件"><a href="#VUE加载自动触发元素点击事件" class="headerlink" title="VUE加载自动触发元素点击事件"></a>VUE加载自动触发元素点击事件</h2><h3 id="SubTemplate"><a href="#SubTemplate" class="headerlink" title="SubTemplate"></a>SubTemplate</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">directives</span>: &#123;</span><br><span class="line">  <span class="attr">trigger</span>: &#123;</span><br><span class="line">    <span class="attr">triggerFlag</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="title function_">inserted</span>(<span class="params">el,binging</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(binging.<span class="property">def</span>.<span class="property">triggerFlag</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      el.<span class="title function_">click</span>()</span><br><span class="line">      binging.<span class="property">def</span>.<span class="property">triggerFlag</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;&#125;,</span><br></pre></td></tr></table></figure><h2 id="Javascript数组内容"><a href="#Javascript数组内容" class="headerlink" title="Javascript数组内容"></a>Javascript数组内容</h2><h3 id="filter"><a href="#filter" class="headerlink" title="filter()"></a>filter()</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 过滤</span></span><br><span class="line"><span class="keyword">let</span> numArr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</span><br><span class="line"><span class="keyword">let</span> res = numArr.<span class="title function_">filter</span>(<span class="function"><span class="params">num</span> =&gt;</span> num &gt;= <span class="number">5</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res) <span class="comment">// [5, 6, 7]</span></span><br></pre></td></tr></table></figure><h3 id="重复判断"><a href="#重复判断" class="headerlink" title="重复判断"></a>重复判断</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断数组中是否有重复内容</span></span><br><span class="line"><span class="keyword">let</span> tempArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="keyword">new</span> <span class="title class_">Set</span>(tempArr)).<span class="property">length</span> &lt; tempArr.<span class="property">length</span></span><br></pre></td></tr></table></figure><h3 id="数组内容移动"><a href="#数组内容移动" class="headerlink" title="数组内容移动"></a>数组内容移动</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上移</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">tempArr</span>[index] = <span class="variable language_">this</span>.<span class="property">tempArr</span>.<span class="title function_">splice</span>(index - <span class="number">1</span>, <span class="number">1</span>, <span class="variable language_">this</span>.<span class="property">tempArr</span>[index])[<span class="number">0</span>]</span><br><span class="line"><span class="comment">// 下移</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">tempArr</span>[index] = <span class="variable language_">this</span>.<span class="property">tempArr</span>.<span class="title function_">splice</span>(index + <span class="number">1</span>, <span class="number">1</span>, <span class="variable language_">this</span>.<span class="property">tempArr</span>[index])[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><h2 id="页面事件监听"><a href="#页面事件监听" class="headerlink" title="页面事件监听"></a>页面事件监听</h2><h3 id="监听离开"><a href="#监听离开" class="headerlink" title="监听离开"></a>监听离开</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 离开时监听触发</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// PC端</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;blur&#x27;</span>, <span class="variable language_">this</span>.<span class="property">fn</span>)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;blur&#x27;</span>, <span class="variable language_">this</span>.<span class="property">fn</span>)</span><br><span class="line"><span class="comment">// 移动端</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;visibilitychange&#x27;</span>, <span class="variable language_">this</span>.<span class="property">fn</span>)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;visibilitychange&#x27;</span>, <span class="variable language_">this</span>.<span class="property">fn</span>)</span><br></pre></td></tr></table></figure><h2 id="Css内容"><a href="#Css内容" class="headerlink" title="Css内容"></a>Css内容</h2><h3 id="线性渐变背景颜色"><a href="#线性渐变背景颜色" class="headerlink" title="线性渐变背景颜色"></a>线性渐变背景颜色</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* css线性渐变背景颜色 */</span></span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to right , <span class="number">#ffce7b</span>, <span class="number">#ff6609</span>);</span><br></pre></td></tr></table></figure><h3 id="右上角三角标"><a href="#右上角三角标" class="headerlink" title="右上角三角标"></a>右上角三角标</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* css右上角三角标 */</span></span><br><span class="line"><span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(<span class="number">225deg</span>, <span class="number">#f44336</span> <span class="number">20%</span>, <span class="number">#00dd00</span> <span class="number">20%</span>);</span><br></pre></td></tr></table></figure><h2 id="移动端Debug"><a href="#移动端Debug" class="headerlink" title="移动端Debug"></a>移动端Debug</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vconsole@latest/dist/vconsole.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"> <span class="comment">// VConsole 默认会挂载到 `window.VConsole` 上</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> vConsole = <span class="keyword">new</span> <span class="variable language_">window</span>.<span class="title class_">VConsole</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成公钥私钥配对</span></span><br><span class="line">$ ssh-keygen -t ed25519 -C <span class="string">&quot;邮箱&quot;</span></span><br><span class="line"><span class="comment"># git基础信息设置</span></span><br><span class="line">$ git config --global user.name <span class="string">&quot;&quot;</span></span><br><span class="line">$ git config --global user.email <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>DrissionPage</title>
      <link href="/2023/12/21/drissionpage/"/>
      <url>/2023/12/21/drissionpage/</url>
      
        <content type="html"><![CDATA[<p>DrissionPage 是一个基于 python 的网页自动化工具。<br>它既能控制浏览器，也能收发数据包，还能把两者合而为一。<br>可兼顾浏览器自动化的便利性和 requests 的高效率。<br>它功能强大，内置无数人性化设计和便捷功能。<br>它的语法简洁而优雅，代码量少，对新手友好。</p><h2 id="1-运行环境"><a href="#1-运行环境" class="headerlink" title="1. 运行环境"></a>1. 运行环境</h2><p>操作系统：Windows、Linux 或 Mac。<br>python 版本：3.6 及以上<br>支持浏览器：Chromium 内核（如 Chrome 和 Edge）</p><h2 id="2-pip安装及升级"><a href="#2-pip安装及升级" class="headerlink" title="2. pip安装及升级"></a>2. pip安装及升级</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install DrissionPage # pip安装DrissionPage</span><br><span class="line">pip install DrissionPage --upgrade # pip升级DrissionPage</span><br></pre></td></tr></table></figure><h2 id="3-基本内容"><a href="#3-基本内容" class="headerlink" title="3. 基本内容"></a>3. 基本内容</h2><p>页面类用于控制浏览器，或收发数据包，是最主要的工具。DrissionPage 包含三种主要页面类。根据须要在其中选择使用。</p><h3 id="3-1-WebPage"><a href="#3-1-WebPage" class="headerlink" title="3.1 WebPage"></a>3.1 WebPage</h3><pre><code>功能最全面的页面类，既可控制浏览器，也可收发数据包(包含了ChromiumPage和SessionPage)通过change_mode()方法切换模式(ChromiumPage: &#39;d&#39;, SessionPage: &#39;s&#39;)<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage <span class="keyword">import</span> WebPage</span><br></pre></td></tr></table></figure></code></pre><h3 id="3-2-ChromiumPage"><a href="#3-2-ChromiumPage" class="headerlink" title="3.2 ChromiumPage"></a>3.2 ChromiumPage</h3><pre><code>用于只控制浏览器<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage <span class="keyword">import</span> ChromiumPage</span><br></pre></td></tr></table></figure></code></pre><h3 id="3-3-SessionPage"><a href="#3-3-SessionPage" class="headerlink" title="3.3 SessionPage"></a>3.3 SessionPage</h3><pre><code>用于只收发数据包<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage <span class="keyword">import</span> SessionPage</span><br></pre></td></tr></table></figure></code></pre><h2 id="4-配置工具"><a href="#4-配置工具" class="headerlink" title="4. 配置工具"></a>4. 配置工具</h2><p>很多时候我们须要设置启动参数，可导入以下两个类，但不是必须的。</p><h3 id="4-1-ChromiumOptions类"><a href="#4-1-ChromiumOptions类" class="headerlink" title="4.1 ChromiumOptions类"></a>4.1 ChromiumOptions类</h3><pre><code>用于设置浏览器启动参数<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage <span class="keyword">import</span> ChromiumOptions</span><br></pre></td></tr></table></figure></code></pre><h3 id="4-2-SessionOptions类"><a href="#4-2-SessionOptions类" class="headerlink" title="4.2 SessionOptions类"></a>4.2 SessionOptions类</h3><pre><code>用于设置Session对象启动参数<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage <span class="keyword">import</span> SessionOptions</span><br></pre></td></tr></table></figure></code></pre><h3 id="4-3-Settings"><a href="#4-3-Settings" class="headerlink" title="4.3 Settings"></a>4.3 Settings</h3><pre><code>用于设置全局配置<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage.common <span class="keyword">import</span> Settings</span><br></pre></td></tr></table></figure></code></pre><h2 id="5-其他工具"><a href="#5-其他工具" class="headerlink" title="5. 其他工具"></a>5. 其他工具</h2><p>可能需要用到的工具，需要时可以导入。</p><h3 id="5-1-动作链"><a href="#5-1-动作链" class="headerlink" title="5.1 动作链"></a>5.1 动作链</h3><pre><code>用于模拟一系列键盘和鼠标的操作<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage.common <span class="keyword">import</span> ActionChains</span><br></pre></td></tr></table></figure></code></pre><h3 id="5-2-键盘按键类"><a href="#5-2-键盘按键类" class="headerlink" title="5.2 键盘按键类"></a>5.2 键盘按键类</h3><pre><code>用于键入 ctrl、alt 等按键<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage.common <span class="keyword">import</span> Keys</span><br></pre></td></tr></table></figure></code></pre><h3 id="5-3-By类"><a href="#5-3-By类" class="headerlink" title="5.3 By类"></a>5.3 By类</h3><pre><code>便于项目迁移<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage.common <span class="keyword">import</span> By</span><br></pre></td></tr></table></figure></code></pre><h3 id="5-4-浏览器数据包监听器"><a href="#5-4-浏览器数据包监听器" class="headerlink" title="5.4 浏览器数据包监听器"></a>5.4 浏览器数据包监听器</h3><pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage.common <span class="keyword">import</span> Listener, RequestMan</span><br></pre></td></tr></table></figure></code></pre><h3 id="5-5-easy-set"><a href="#5-5-easy-set" class="headerlink" title="5.5 easy_set"></a>5.5 easy_set</h3><pre><code>保存了一些便捷的 ini 文件设置方法，可选择使用<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage.easy_set <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure></code></pre><h2 id="6-导入异常"><a href="#6-导入异常" class="headerlink" title="6. 导入异常"></a>6. 导入异常</h2><pre><code>异常放在以下路径<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> DrissionPage.errors <span class="keyword">import</span> ElementNotFoundError</span><br></pre></td></tr></table></figure></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Django</title>
      <link href="/2023/11/10/django/"/>
      <url>/2023/11/10/django/</url>
      
        <content type="html"><![CDATA[<p>关于Python的服务端框架-Django(有大量的基础服务内容，可创建多模块分配)。当前使用环境：python –version 3.11.1、pip –version 23.3.1。</p><h2 id="安装Django-及-其他依赖包"><a href="#安装Django-及-其他依赖包" class="headerlink" title="安装Django 及 其他依赖包"></a>安装Django 及 其他依赖包</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install django # 框架依赖包 version 4.2.7</span><br><span class="line">pip install django-cors-headers # 处理跨域的依赖包</span><br><span class="line">pip install pymysql # mysql模块依赖包</span><br></pre></td></tr></table></figure><h2 id="依赖记录"><a href="#依赖记录" class="headerlink" title="依赖记录"></a>依赖记录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建依赖记录</span></span><br><span class="line">pip freeze &gt; requirements.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">依赖记录安装</span></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Django-admin startproject templateName</span><br></pre></td></tr></table></figure><h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><h3 id="处理跨域访问"><a href="#处理跨域访问" class="headerlink" title="处理跨域访问"></a>处理跨域访问</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础配置文件配置以下内容</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&#x27;*&#x27;</span>]</span><br><span class="line"></span><br><span class="line">CORS_ALLOW_CREDENTIALS = <span class="literal">True</span></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span></span><br><span class="line">CORS_ORIGIN_WHITELIST = (<span class="string">&#x27;http://localhost&#x27;</span>, <span class="string">&#x27;http://127.0.0.1&#x27;</span>, <span class="string">&#x27;http://0.0.0.0&#x27;</span>)</span><br><span class="line">SECURE_CROSS_ORIGIN_OPENER_POLICY = <span class="literal">None</span> <span class="comment"># 默认值为same-origin</span></span><br><span class="line"></span><br><span class="line">CORS_ALLOW_METHODS = (</span><br><span class="line">    <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;OPTIONS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PATCH&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;VIEW&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">CORS_ALLOW_HEADERS = (<span class="string">&#x27;*&#x27;</span>,)</span><br></pre></td></tr></table></figure><h3 id="模块创建"><a href="#模块创建" class="headerlink" title="模块创建"></a>模块创建</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp AppOne # 创建AppOne模块</span><br><span class="line">python manage.py startapp AppTwo # 创建AppTwo模块</span><br></pre></td></tr></table></figure><h3 id="模块注册"><a href="#模块注册" class="headerlink" title="模块注册"></a>模块注册</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模块创建完成后需要注册</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;AppOne.apps.ApponeConfig&#x27;</span>, <span class="comment">#注册AppOne</span></span><br><span class="line">    <span class="string">&#x27;AppTwo.apps.ApptwoConfig&#x27;</span>, <span class="comment">#注册AppTwo</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># __init__.py</span></span><br><span class="line"><span class="keyword">import</span> pymysql  <span class="comment"># 导入第三方模块，用来操作mysql数据库</span></span><br><span class="line">pymysql.install_as_MySQLdb()</span><br><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment"># django默认数据库</span></span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.sqlite3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: BASE_DIR / <span class="string">&#x27;db.sqlite3&#x27;</span>,</span><br><span class="line">        <span class="comment"># mysql远程数据库</span></span><br><span class="line">        <span class="comment"># &#x27;ENGINE&#x27;: &#x27;django.db.backends.mysql&#x27;, # 更改为mysql</span></span><br><span class="line">        <span class="comment"># &#x27;NAME&#x27;: &#x27;example&#x27;, # testsql数据库名</span></span><br><span class="line">        <span class="comment"># &#x27;USER&#x27;: &#x27;example&#x27;, # 数据库的用户名</span></span><br><span class="line">        <span class="comment"># &#x27;PASSWORD&#x27;: &#x27;example123&#x27;, # 密码</span></span><br><span class="line">        <span class="comment"># &#x27;HOST&#x27;: &#x27;*.*.*.*&#x27;,</span></span><br><span class="line">        <span class="comment"># &#x27;PORT&#x27;: &#x27;3306&#x27;, # 端口号，默认为3306</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Django模型"><a href="#Django模型" class="headerlink" title="Django模型"></a>Django模型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义AppOne的模型  /&gt;AppOne&gt;models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>) <span class="comment"># id 会自动创建,可以手动写入</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>) <span class="comment"># 书籍名称</span></span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">5</span>, decimal_places=<span class="number">2</span>) <span class="comment"># 书籍价格</span></span><br><span class="line">    publish = models.CharField(max_length=<span class="number">32</span>) <span class="comment"># 出版社名称</span></span><br><span class="line">    pub_date = models.DateField() <span class="comment"># 出版时间</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations AppOne # 映射AppOne的models</span><br><span class="line">python manage.py migrate 同步AppOne的models到数据库</span><br></pre></td></tr></table></figure><h3 id="后台管理员配置"><a href="#后台管理员配置" class="headerlink" title="后台管理员配置"></a>后台管理员配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">需要先映射同步数据库</span></span><br><span class="line">python manage.py makemigrations 映射models</span><br><span class="line">python manage.py migrate 同步到数据库</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建超级用户</span></span><br><span class="line">python manage.py createsuperuser</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">http://ip:端口/admin/ 访问后台</span></span><br></pre></td></tr></table></figure><h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver 0.0.0.0:5000 # 启动到局域网内5000端口</span><br><span class="line">python manage.py runserver 127.0.0.1:5000 # 启动到本地5000端口</span><br></pre></td></tr></table></figure><h2 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include <span class="comment"># include用于多项目时分发</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&quot;user/&quot;</span>, include(<span class="string">&quot;user.urls&quot;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="模块视图"><a href="#模块视图" class="headerlink" title="模块视图"></a>模块视图</h2><h3 id="子路由配置"><a href="#子路由配置" class="headerlink" title="子路由配置"></a>子路由配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /&gt;AppOne&gt;urls.py</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path <span class="comment"># 用re_path 需要引入</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> AppOne <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;search/&#x27;</span>, views.searchUser), <span class="comment"># 普通路径</span></span><br><span class="line">    re_path(<span class="string">r&#x27;^index1/([0-9]&#123;4&#125;)/$&#x27;</span>, views.index1), <span class="comment"># 正则路径（无名分组）http://127.0.0.1:5000/user/index1/2023/</span></span><br><span class="line">    re_path(<span class="string">&quot;^index2/(?P&lt;year&gt;[0-9]&#123;4&#125;)/(?P&lt;month&gt;[0-9]&#123;2&#125;)/$&quot;</span>, views.index2), <span class="comment"># 正则路径（路由形参）http://127.0.0.1:5000/user/index2/2023/05/</span></span><br><span class="line">    <span class="comment"># r:代表的是原生字符串（raw）</span></span><br><span class="line">    <span class="comment"># ^:代表以什么开头</span></span><br><span class="line">    <span class="comment"># $:代表的是以什么结尾</span></span><br><span class="line">    <span class="comment"># /article/list/(year)/</span></span><br><span class="line">    <span class="comment"># 在正则表达式中定义一个变量，参数，就需要用（）进行捕获参数。</span></span><br><span class="line">    <span class="comment"># 给捕获的参数去一个名字，就可以使用&lt;&gt;,（?P&lt;year&gt;）</span></span><br><span class="line">    <span class="comment"># \d:代表是0-9之间的数字</span></span><br><span class="line">    <span class="comment"># &#123;4&#125;：代表的是这样的数字有4个。</span></span><br><span class="line">    <span class="comment"># 在我们的$符号前面有一个/，代表的是要以/结尾。</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="子模型注册Admin"><a href="#子模型注册Admin" class="headerlink" title="子模型注册Admin"></a>子模型注册Admin</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /&gt;AppOne&gt;admin.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> Book</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line">admin.site.register([Book])</span><br></pre></td></tr></table></figure><h3 id="视图内容"><a href="#视图内容" class="headerlink" title="视图内容"></a>视图内容</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /&gt;AppOne&gt;views.py</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, JsonResponse</span><br><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> serializers <span class="comment"># 格式化json serializers.serialize(&quot;json&quot;, models.Book.objects.all())</span></span><br><span class="line"><span class="keyword">from</span> user <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">searchUser</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 请求接口返回示例</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="comment"># GET</span></span><br><span class="line">        name = request.GET.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;user：&quot;</span> + name)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="comment"># POST</span></span><br><span class="line">        name = request.POST.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;user：&quot;</span> + name)  <span class="comment"># 字符串作为返回内容</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index1</span>(<span class="params">request, year</span>):</span><br><span class="line">    <span class="comment"># 请求接口返回示例</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(year) <span class="comment"># 一个形参代表路径中一个分组的内容，按关键字对应匹配</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index2</span>(<span class="params">request, year, month</span>):</span><br><span class="line">    <span class="comment"># 请求接口返回示例</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(year + <span class="string">&#x27;-&#x27;</span> + month) <span class="comment"># 一个形参代表路径中一个分组的内容，按关键字对应匹配</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Raspberry pi</title>
      <link href="/2023/10/16/raspberry-pi/"/>
      <url>/2023/10/16/raspberry-pi/</url>
      
        <content type="html"><![CDATA[<p>关于Raspberry 初次使用注意以及基本内容，持续完善中…</p><h2 id="系统烧录"><a href="#系统烧录" class="headerlink" title="系统烧录"></a>系统烧录</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. 解压下载的系统压缩文件，得到img镜像文件</span><br><span class="line">2. 将SD使用卡托或者读卡器后，连上电脑</span><br><span class="line">3. 解压并运行win32diskimager工具（需要先格式化SD卡）</span><br><span class="line">4. 在软件中选择img（镜像）文件，“Device”下选择SD的盘符，然后选择“Write”</span><br><span class="line"># 然后就开始安装系统了，根据你的SD速度，安装过程有快有慢。</span><br><span class="line"></span><br><span class="line">ps：树莓派官网提供的烧录工具选择更多点 https://www.raspberrypi.com/software/</span><br></pre></td></tr></table></figure><h2 id="首次开机"><a href="#首次开机" class="headerlink" title="首次开机"></a>首次开机</h2><h3 id="关于账号"><a href="#关于账号" class="headerlink" title="关于账号"></a>关于账号</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用户名：pi</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">密码：yahboom / raspberry</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">root用户原始系统是没有开启的，自己设置密码就可以</span></span><br><span class="line">sudo passwd root # 输入两次密码确认</span><br><span class="line">sudo passwd --unlock root # 解锁root用户</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换root：</span></span><br><span class="line">su # 确认后输入密码</span><br></pre></td></tr></table></figure><h3 id="进入后界面操作"><a href="#进入后界面操作" class="headerlink" title="进入后界面操作"></a>进入后界面操作</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打开树莓派系统下的命令行终端（Ctrl+Alt+T）</span></span><br><span class="line"></span><br><span class="line">ifconfig # 查看我们的ip地址</span><br><span class="line"></span><br><span class="line">sudo raspi-config # 进入到树莓派系统配置界面</span><br></pre></td></tr></table></figure><h3 id="关于几个常用命令"><a href="#关于几个常用命令" class="headerlink" title="关于几个常用命令"></a>关于几个常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看操作系统版本</span></span><br><span class="line">cat /proc/version</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看主板版本</span></span><br><span class="line">cat /proc/cpuinfo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看SD存储卡剩余空间</span></span><br><span class="line">df -h</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看ip地址</span></span><br><span class="line">ifconfig</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩</span></span><br><span class="line">tar –zcvf  filename.tar.gz dirname</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压</span></span><br><span class="line">tar –zxvf filename.tar.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Linux更改文件权限（递归子集）</span></span><br><span class="line">chmod -R 777 /home/test</span><br></pre></td></tr></table></figure><h2 id="关机注意"><a href="#关机注意" class="headerlink" title="关机注意"></a>关机注意</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">不能直接拔掉电源，会造成树莓派数据无法及时保存而丢失</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以按需选择相关的终端命令操作</span></span><br><span class="line">sudo poweroff # 关闭电源</span><br><span class="line">sudo shutdown -h now # 立刻关机</span><br><span class="line">sudo shutdown -r now # 立刻重启</span><br><span class="line">sudo reboot # 重启</span><br><span class="line">sudo shutdown -h +2 # 2分钟之后关机</span><br></pre></td></tr></table></figure><h2 id="关于pi安装问题"><a href="#关于pi安装问题" class="headerlink" title="关于pi安装问题"></a>关于pi安装问题</h2><h3 id="apt-get基本命令"><a href="#apt-get基本命令" class="headerlink" title="apt-get基本命令"></a>apt-get基本命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">apt-get可简写apt</span></span><br><span class="line">    # 更新源文件</span><br><span class="line">    sudo apt-get update</span><br><span class="line">    # 升级所有已安装的包</span><br><span class="line">    sudo apt-get upgrade</span><br><span class="line">    # 清理无用的包</span><br><span class="line">    sudo apt-get autoclean</span><br><span class="line">    # 检查是否有损坏的依赖</span><br><span class="line">    sudo apt-get check</span><br><span class="line">    # 安装 </span><br><span class="line">    sudo apt-get install _name_</span><br><span class="line">    # 移除</span><br><span class="line">    sudo apt-get remove _name_</span><br><span class="line">    # 删除包，包括配置文件</span><br><span class="line">    sudo apt-get remove _name_ --purge</span><br><span class="line">    # 删除包，包括包及其依赖的软件、配置文件</span><br><span class="line">    sudo apt-get autoremove _name_ --purge</span><br></pre></td></tr></table></figure><h3 id="换源"><a href="#换源" class="headerlink" title="换源"></a>换源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下面两个源都可使用</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb https://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deb https://mirrors.ustc.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi</span></span><br><span class="line"></span><br><span class="line">sudo nano /etc/apt/sources.list # 进入该配置文件更换源</span><br><span class="line"></span><br><span class="line">sudo apt update # 配置完成后执行该命令使生效</span><br></pre></td></tr></table></figure><h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">树莓派无法直接安装mysql，建议使用 mariadb-server-10.0 ，用法一致</span></span><br><span class="line">sudo apt-get install mariadb-server-10.0</span><br></pre></td></tr></table></figure><h3 id="解决无密码可登录mysql的问题"><a href="#解决无密码可登录mysql的问题" class="headerlink" title="解决无密码可登录mysql的问题"></a>解决无密码可登录mysql的问题</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入mysql后执行</span></span><br><span class="line">SET password for &#x27;root&#x27;@&#x27;localhost&#x27;=password(&#x27;123456&#x27;); # 设置密码</span><br><span class="line">UPDATE user SET plugin=&#x27;mysql_native_password&#x27; WHERE user=&#x27;root&#x27;; # 修改root用户为校验密码</span><br><span class="line">exit;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出MySQL执行</span></span><br><span class="line">systemctl restart mysql # 重启mysql，执行后选择账户输入密码即可</span><br><span class="line"></span><br><span class="line">cd /etc/mysql # 配置文件下的bind-host改为0.0.0.0，允许任意远程登录</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mysql内执行</span></span><br><span class="line">create user &#x27;example&#x27;@&#x27;%&#x27; identified by &#x27;example123&#x27;; # 创建用户</span><br><span class="line">grant all on example.* to &#x27;example&#x27;@&#x27;%&#x27;; # 指定访问数据库</span><br><span class="line">flush privileges; # 更新配置信息</span><br></pre></td></tr></table></figure><h3 id="安装node"><a href="#安装node" class="headerlink" title="安装node"></a>安装node</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载nvm的包放入/home/pi(也就是~的指向路径)</span></span><br><span class="line">sudo nano ~/.bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改.bashrc文件在后面写入以下内容</span></span><br><span class="line">    export NVM_DIR=&quot;$HOME/.nvm/nvm-0.38.0&quot;</span><br><span class="line">    [ -s &quot;$NVM_DIR/nvm.sh&quot; ] &amp;&amp; \. &quot;$NVM_DIR/nvm.sh&quot;  # This loads nvm</span><br><span class="line">    [ -s &quot;$NVM_DIR/bash_completion&quot; ] &amp;&amp; \. &quot;$NVM_DIR/bash_completion&quot;  # This loads nvm bash_completion</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行命令更新配置</span></span><br><span class="line">source ~/.bashrc</span><br><span class="line"></span><br><span class="line">nvm install 16.19.0</span><br><span class="line">nvm install 14.21.2</span><br><span class="line">nvm install 8.17.0</span><br></pre></td></tr></table></figure><h2 id="部署node项目（pm2）"><a href="#部署node项目（pm2）" class="headerlink" title="部署node项目（pm2）"></a>部署node项目（pm2）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装pm2</span></span><br><span class="line">npm install pm2 -g</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看版本</span></span><br><span class="line">pm2 --version</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">pm2 start app.js</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止服务</span></span><br><span class="line">pm2 stop app.js</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看服务状态</span></span><br><span class="line">pm2 monit</span><br><span class="line">pm2 list</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同步进程</span></span><br><span class="line">pm2 save</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Media Server</title>
      <link href="/2023/10/10/media-server/"/>
      <url>/2023/10/10/media-server/</url>
      
        <content type="html"><![CDATA[<p>关于推流、拉流命令行控制及开发依赖<br>&#x2F;&#x2F; 后管地址 127.0.0.1:8000&#x2F;admin&#x2F;<br>&#x2F;&#x2F; 接口：<a href="http://127.0.0.1:8000/api/server">http://127.0.0.1:8000/api/server</a> &#x2F;&#x2F; 性能线程监控<br>&#x2F;&#x2F; 接口：<a href="http://127.0.0.1:8000/api/streams">http://127.0.0.1:8000/api/streams</a> &#x2F;&#x2F; 查询推流列表</p><h2 id="ffmpeg-shell-x2F-cmd"><a href="#ffmpeg-shell-x2F-cmd" class="headerlink" title="ffmpeg(shell&#x2F;cmd)"></a>ffmpeg(shell&#x2F;cmd)</h2><h3 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dshow可以用来抓取摄像头、采集卡、麦克风等，vfwcap主要用来采集摄像头类设备，gdigrab则是抓取Windows窗口程序</span></span><br><span class="line">ffmpeg -list_devices true -f dshow -i dummy # 查询可用dshow设备</span><br><span class="line"></span><br><span class="line">-f vfwcap -i &quot;0&quot; # 启用摄像头</span><br><span class="line">-f gdigrab -i desktop 启用桌面录制 -f gdigrab -i title=&quot;&quot; # 启用应用录制</span><br><span class="line">-f dshow -i video=&quot;&quot; 指定video设备 -f dshow -i audio=&quot;&quot; # 指定audio设备</span><br><span class="line">-re -stream_loop -1 # 重复</span><br><span class="line">-vcodec libx264 -preset ultrafast # video指定解码配置</span><br><span class="line">-acodec libmp3lame -ar 44100 -ac 1 # audio指定解码配置</span><br><span class="line">-c:v libx264 -preset ultrafast  # vfwcap摄像头使用video配置</span><br></pre></td></tr></table></figure><h3 id="RTMP协议推流"><a href="#RTMP协议推流" class="headerlink" title="RTMP协议推流"></a>RTMP协议推流</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重复推流test.mp4至rtmp接口</span></span><br><span class="line">ffmpeg -re -stream_loop -1 -i test.mp4 -vcodec libx264 -preset ultrafast -f flv rtmp://localhost:1935/stream/test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">摄像头推流至rtmp接口（不包含acodec）</span></span><br><span class="line">ffmpeg -f vfwcap  -i &quot;0&quot; -c:v libx264 -preset ultrafast -f flv rtmp://localhost:1935/media/home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">桌面desktop推流至rtmp接口（不包含acodec）</span></span><br><span class="line">ffmpeg -f gdigrab -i desktop -vcodec libx264 -preset ultrafast -f flv rtmp://192.168.52.51:1935/media/home</span><br></pre></td></tr></table></figure><h3 id="ffmpeg本地"><a href="#ffmpeg本地" class="headerlink" title="ffmpeg本地"></a>ffmpeg本地</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从视频中提取音频</span></span><br><span class="line">ffmpeg.exe -i aa.mp4 -vn -c:a copy output.aac</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-vn 表示去掉视频， -c:a copy表示不改变音频编码，直接拷贝。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进行指定时间截图</span></span><br><span class="line">ffmpeg.exe -ss 0:8:34 -i aa.mp4 -vframes 1 -q:v 2 output.jpg</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-vframes1表示只截取一帧， -q:v2表示输出的图片质量，通常范围在1到5之间（1 为最高质量）</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">为音频添加封面</span></span><br><span class="line">ffmpeg -loop 1 -i cover.jpg -i input.mp3 -c:v libx264 -c:a aac -b:a 192k -shortest output.mp4</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以上命令中，有两个输入文件，一个是封面图片 cover.jpg，另一个是音频文件 input.mp3。-loop1参数表示图片无限循环，  -shortest参数表示音频文件结束时，输出视频也随之结束。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MP4 转 M3U8</span></span><br><span class="line">ffmpeg -i input.mp4 -c:v libx264 -c:a aac -strict -2 -f hls -hlslistsize 2 -hls_time 15 output.m3u8</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">该命令将 input.mp4 视频文件每15秒生成一个 ts 文件，并最后生成一个 m3u8 文件，m3u8 文件则作为 ts 的索引文件。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">屏幕录制并保存成文件</span></span><br><span class="line">ffmpeg -f gdigrab -i desktop eguid.mp4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">转流（rtsp转rtmp为例）</span></span><br><span class="line">ffmpeg -i rtsp://184.72.239.149/vod/mp4://BigBuckBunny_175k.mov -rtsp_transport tcp -vcodec h264 -acodec aac -f flv rtmp://localhost:1935/rtmp/eguid</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉流</span></span><br><span class="line">ffmpeg -i rtmp://eguid.cc:1935/rtmp/eguid -vcodec h264 -f flv -acodec aac -ac 2 eguid.flv</span><br></pre></td></tr></table></figure><h2 id="win命令控制"><a href="#win命令控制" class="headerlink" title="win命令控制"></a>win命令控制</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令前+start新开命令窗口执行</span></span><br><span class="line">tasklist # 查询所有进程</span><br><span class="line">tasklist /fi &quot;imagename eq ffmpeg.exe&quot; # 根据名字查询进程</span><br><span class="line">taskkill /f /im ffmpeg.exe # 根据进程名结束进程</span><br><span class="line">taskkill /pid 13044 -f # 根据pid值结束进程</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>树状表Sql</title>
      <link href="/2023/08/30/treesql/"/>
      <url>/2023/08/30/treesql/</url>
      
        <content type="html"><![CDATA[<p>只记录了左右值和路径值的树型结构，个人感觉路径值更好用一点</p><h2 id="左右值-lft-rgt"><a href="#左右值-lft-rgt" class="headerlink" title="左右值(lft, rgt)"></a>左右值(lft, rgt)</h2><pre><code>查询很好用，但是新增删除时需要操作执行整个表的内容，存储失败时难以回滚，还会有并发冲突的问题，只适合内容稳定修改较少的表类型</code></pre><h3 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +----+-------------+-------+--------+-----+-----+----------+-------------+</span></span><br><span class="line"><span class="comment">// | id | name        | value | type   | lft | rgt | parentId | valuePrefix |</span></span><br><span class="line"><span class="comment">// +----+-------------+-------+--------+-----+-----+----------+-------------+</span></span><br><span class="line"><span class="comment">// |  1 | SYSTEM_NAME | 0     | system |   1 |  28 | NULL     | sys:        |</span></span><br><span class="line"><span class="comment">// |  2 | 系统维护    | 0     | menu   |   2 |  21 |        1 | sys:0:      |</span></span><br><span class="line"><span class="comment">// |  3 | 人员管理    | 1     | page   |  22 |  27 |        1 | sys:0:      |</span></span><br><span class="line"><span class="comment">// |  4 | 组织管理    | 0     | page   |   3 |   4 |        2 | sys:0:0:    |</span></span><br><span class="line"><span class="comment">// |  5 | 角色管理    | 1     | page   |   5 |  10 |        2 | sys:0:0:    |</span></span><br><span class="line"><span class="comment">// |  6 | 权限管理    | 2     | page   |  11 |  16 |        2 | sys:0:0:    |</span></span><br><span class="line"><span class="comment">// |  7 | 操作日志    | 3     | page   |  17 |  18 |        2 | sys:0:0:    |</span></span><br><span class="line"><span class="comment">// |  8 | 系统设置    | 4     | page   |  19 |  20 |        2 | sys:0:0:    |</span></span><br><span class="line"><span class="comment">// |  9 | 新增        | 0     | button |   6 |   7 |        5 | sys:0:0:1:  |</span></span><br><span class="line"><span class="comment">// | 10 | 新增        | 0     | button |  12 |  13 |        6 | sys:0:0:2:  |</span></span><br><span class="line"><span class="comment">// | 11 | 编辑        | 1     | button |   8 |   9 |        5 | sys:0:0:1:  |</span></span><br><span class="line"><span class="comment">// | 12 | 编辑        | 1     | button |  14 |  15 |        6 | sys:0:0:2:  |</span></span><br><span class="line"><span class="comment">// | 13 | 新增        | 0     | button |  23 |  24 |        3 | sys:0:1:    |</span></span><br><span class="line"><span class="comment">// | 14 | 编辑        | 1     | button |  25 |  26 |        3 | sys:0:1:    |</span></span><br><span class="line"><span class="comment">// +----+-------------+-------+--------+-----+-----+----------+-------------+</span></span><br><span class="line">SET <span class="meta">@lft</span> := <span class="number">7</span>;<span class="comment">/*新部门的左值*/</span></span><br><span class="line">SET <span class="meta">@rgt</span> := <span class="number">8</span>;<span class="comment">/*新部门的右值*/</span></span><br><span class="line">SET <span class="meta">@level</span> := <span class="number">5</span>;<span class="comment">/*新部门的层级*/</span></span><br><span class="line">begin;</span><br><span class="line"><span class="comment">/*将插入的后续边缘的节点左右数+2*/</span></span><br><span class="line">UPDATE department SET lft=lft+<span class="number">2</span> WHERE lft &gt; <span class="meta">@lft</span>;</span><br><span class="line">UPDATE department SET rgt=rgt+<span class="number">2</span> WHERE rgt &gt;= <span class="meta">@lft</span>;</span><br><span class="line"><span class="comment">/*插入数据*/</span></span><br><span class="line">INSERT INTO <span class="title function_">department</span><span class="params">(name,lft,rgt,level)</span> VALUES(<span class="string">&#x27;新部门&#x27;</span>,<span class="meta">@lft</span>,<span class="meta">@rgt</span>,level);</span><br><span class="line"><span class="comment">/*新增影响行数为0时，必须回滚*/</span></span><br><span class="line">commit;</span><br><span class="line"><span class="comment">/*rollback;*/</span></span><br></pre></td></tr></table></figure><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SET <span class="meta">@lft</span> := <span class="number">7</span>;<span class="comment">/*要删除的节点左值*/</span></span><br><span class="line">SET <span class="meta">@rgt</span> := <span class="number">8</span>;<span class="comment">/*要删除的节点右值*/</span></span><br><span class="line">begin;</span><br><span class="line">UPDATE department SET lft=lft-<span class="number">2</span> WHERE lft &gt; <span class="meta">@lft</span>;</span><br><span class="line">UPDATE department SET rgt=rgt-<span class="number">2</span> WHERE rgt &gt; <span class="meta">@lft</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*删除节点*/</span></span><br><span class="line">DELETE FROM department WHERE lft=<span class="meta">@lft</span> AND rgt=<span class="meta">@rgt</span>;</span><br><span class="line"><span class="comment">/*删除影响行数为0时，必须回滚*/</span></span><br><span class="line">commit;</span><br><span class="line"><span class="comment">/*rollback*/</span></span><br></pre></td></tr></table></figure><h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><h4 id="查询所有子孙"><a href="#查询所有子孙" class="headerlink" title="查询所有子孙"></a>查询所有子孙</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SET <span class="meta">@lft</span> := <span class="number">9</span>;</span><br><span class="line">SET <span class="meta">@rgt</span> := <span class="number">18</span>;</span><br><span class="line">SELECT * FROM department WHERE lft BETWEEN <span class="meta">@lft</span> AND <span class="meta">@rgt</span> ORDER BY lft ASC;</span><br><span class="line"><span class="comment">// `SELECT user_name FROM temp_pro_user WHERE lft &gt;= @lft AND lft &lt;= @rgt ORDER BY lft ASC`;</span></span><br><span class="line"><span class="comment">/*例子中用BETWEEN将被查部门本身也查了出来。实际中可以用大于小于*/</span></span><br></pre></td></tr></table></figure><h4 id="查询下属总数"><a href="#查询下属总数" class="headerlink" title="查询下属总数"></a>查询下属总数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 总数 = (右值 - 左值 - 1) / 2</span></span><br></pre></td></tr></table></figure><h4 id="查询一级下属"><a href="#查询一级下属" class="headerlink" title="查询一级下属"></a>查询一级下属</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SET <span class="meta">@level</span> := <span class="number">2</span>;<span class="comment">/*总经理的level*/</span></span><br><span class="line">SET <span class="meta">@lft</span> := <span class="number">2</span>;<span class="comment">/*总经理的左值*/</span></span><br><span class="line">SET <span class="meta">@rgt</span> := <span class="number">19</span>;<span class="comment">/*总经理的右值*/</span></span><br><span class="line"></span><br><span class="line">SELECT * FROM department WHERE lft &gt; <span class="meta">@lft</span> AND rgt &lt; <span class="meta">@rgt</span> <span class="type">AND</span> <span class="variable">level</span> <span class="operator">=</span> <span class="meta">@level</span>+<span class="number">1</span>;</span><br></pre></td></tr></table></figure><h4 id="查询祖链路径"><a href="#查询祖链路径" class="headerlink" title="查询祖链路径"></a>查询祖链路径</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SET <span class="meta">@lft</span> := <span class="number">3</span>;<span class="comment">/*产品部左值*/</span></span><br><span class="line">SET <span class="meta">@rgt</span> := <span class="number">8</span>;<span class="comment">/*产品部右值*/</span></span><br><span class="line"></span><br><span class="line">SELECT * FROM department WHERE lft &lt; <span class="meta">@lft</span> AND rgt &gt; <span class="meta">@rgt</span> ORDER BY lft ASC;</span><br></pre></td></tr></table></figure><h4 id="查询后转成树结构"><a href="#查询后转成树结构" class="headerlink" title="查询后转成树结构"></a>查询后转成树结构</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list = [<span class="comment">//模拟sql查出来的列表。</span></span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">&#x27;root&#x27;</span>,<span class="attr">lft</span>:<span class="number">1</span>,<span class="attr">rgt</span>:<span class="number">8</span>,<span class="attr">level</span>:<span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">name</span>:<span class="string">&#x27;child&#x27;</span>,<span class="attr">lft</span>:<span class="number">2</span>,<span class="attr">rgt</span>:<span class="number">7</span>,<span class="attr">level</span>:<span class="number">2</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">3</span>,<span class="attr">name</span>:<span class="string">&#x27;grandson&#x27;</span>,<span class="attr">lft</span>:<span class="number">3</span>,<span class="attr">rgt</span>:<span class="number">4</span>,<span class="attr">level</span>:<span class="number">3</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>:<span class="number">4</span>,<span class="attr">name</span>:<span class="string">&#x27;grandson2&#x27;</span>,<span class="attr">lft</span>:<span class="number">5</span>,<span class="attr">rgt</span>:<span class="number">6</span>,<span class="attr">level</span>:<span class="number">3</span>&#125;</span><br><span class="line">];</span><br><span class="line"><span class="keyword">let</span> rights = [] <span class="comment">/*类似于一个栈结构（后进先出）*/</span></span><br><span class="line"><span class="keyword">let</span> mp = &#123;&#125;</span><br><span class="line"><span class="comment">//list.sort((a,b) =&gt; a.lft - b.lft)//如果你在sql中没有进行排序，需要在这里给他排序。</span></span><br><span class="line">list.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(rights.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span>(rights[rights.<span class="property">length</span>-<span class="number">1</span>] &lt; item.<span class="property">rgt</span>) &#123;</span><br><span class="line">            rights.<span class="title function_">splice</span>(-<span class="number">1</span>, <span class="number">1</span>)<span class="comment">//从rights末尾去除</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> _level = rights.<span class="property">length</span>;</span><br><span class="line">    item.<span class="property">_level</span> = _level;</span><br><span class="line">    mp[_level] = item.<span class="property">id</span></span><br><span class="line">    item.<span class="property">parent_id</span> = _level - <span class="number">1</span> <span class="keyword">in</span> mp ? mp[_level - <span class="number">1</span>] : <span class="literal">null</span>;<span class="comment">//计算出上级部门编号</span></span><br><span class="line">    item.<span class="property">is_leaf</span> = item.<span class="property">lft</span> === item.<span class="property">rgt</span> - <span class="number">1</span>;<span class="comment">//判断是否叶子部门</span></span><br><span class="line">    rights.<span class="title function_">push</span>(item.<span class="property">rgt</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*上级部门计算出来了，和存parent_id的效果就一样了，后面只需要递归即可*/</span></span><br><span class="line"><span class="comment">/*递归函数 示例*/</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">recursive</span> = (<span class="params">_list, parent_id = <span class="literal">null</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> _tree = [];</span><br><span class="line">    _list.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(item.<span class="property">parent_id</span> === parent_id) &#123;</span><br><span class="line">            <span class="keyword">let</span> childs = <span class="title function_">recursive</span>(_list, item.<span class="property">id</span>)</span><br><span class="line">            _tree.<span class="title function_">push</span>(&#123;</span><br><span class="line">                ...item,</span><br><span class="line">                <span class="attr">children</span>: childs.<span class="property">length</span> &gt; <span class="number">0</span> ? childs : (item.<span class="property">isLeaf</span> ? <span class="literal">null</span> : [])</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> _tree</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">recursive</span>(list))</span><br></pre></td></tr></table></figure><h2 id="路径值（1-x2F-2-x2F-3-x2F-4-x2F-5-x2F-6-x2F-…）"><a href="#路径值（1-x2F-2-x2F-3-x2F-4-x2F-5-x2F-6-x2F-…）" class="headerlink" title="路径值（1&#x2F;2&#x2F;3&#x2F;4&#x2F;5&#x2F;6&#x2F;…）"></a>路径值（1&#x2F;2&#x2F;3&#x2F;4&#x2F;5&#x2F;6&#x2F;…）</h2><pre><code>查询难度低，需要拼接path内容，存储基本不会出现并发冲突</code></pre><h3 id="查询-1"><a href="#查询-1" class="headerlink" title="查询"></a>查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +----+----------+------------+</span></span><br><span class="line"><span class="comment">// | id | userName | path       |</span></span><br><span class="line"><span class="comment">// +----+----------+------------+</span></span><br><span class="line"><span class="comment">// |  1 | Admin    | 0          |</span></span><br><span class="line"><span class="comment">// |  2 | Ron      | 0/1        |</span></span><br><span class="line"><span class="comment">// |  3 | Ron0     | 0/1/2      |</span></span><br><span class="line"><span class="comment">// |  4 | Bio      | 0/1        |</span></span><br><span class="line"><span class="comment">// |  5 | Ron1     | 0/1/2      |</span></span><br><span class="line"><span class="comment">// |  6 | Bio0     | 0/1/4      |</span></span><br><span class="line"><span class="comment">// |  7 | Bio00    | 0/1/4/6    |</span></span><br><span class="line"><span class="comment">// |  8 | Bio000   | 0/1/4/6/7  |</span></span><br><span class="line"><span class="comment">// +----+----------+------------+</span></span><br><span class="line"><span class="comment">// 查询所有子结构内容(当前id: 2)</span></span><br><span class="line">const <span class="meta">@userPath</span> = user.path + <span class="string">&#x27;/&#x27;</span> + user.id + <span class="string">&#x27;%&#x27;</span></span><br><span class="line">SELECT name FROM TABLENAME WHERE path like <span class="meta">@userPath</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询所有父结构内容(当前id: 8)</span></span><br><span class="line">const <span class="meta">@pathArr</span> = user.path.split(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">SELECT name FROM TABLENAME WHERE id IN <span class="meta">@pathArr</span></span><br></pre></td></tr></table></figure><h3 id="查询后转树状"><a href="#查询后转树状" class="headerlink" title="查询后转树状"></a>查询后转树状</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*递归函数 示例*/</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">recursive</span> = (<span class="params">_list, path = <span class="number">0</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> _tree = [];</span><br><span class="line">    _list.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(item.<span class="property">path</span> === path) &#123;</span><br><span class="line">            <span class="keyword">let</span> childs = <span class="title function_">recursive</span>(_list, (path + <span class="string">&#x27;/&#x27;</span> + item.<span class="property">id</span>))</span><br><span class="line">            _tree.<span class="title function_">push</span>(&#123;</span><br><span class="line">                ...item,</span><br><span class="line">                <span class="attr">children</span>: childs.<span class="property">length</span> &gt; <span class="number">0</span> ? childs : []</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> _tree</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">recursive</span>(list))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
